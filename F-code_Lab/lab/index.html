<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá th·ªëng n·ªôi b·ªô F-Code - Login</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #2c3e50; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        
        .login-card { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 15px 25px rgba(0,0,0,0.5); width: 450px; position: relative; }
        
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #666; font-weight: bold; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        
        /* CSS CHO N√öT HI·ªÜN PASSWORD */
        .password-wrapper { position: relative; }
        .password-wrapper input { padding-right: 40px; }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2rem;
            user-select: none;
            filter: grayscale(100%);
            transition: 0.2s;
        }
        .toggle-password:hover { filter: grayscale(0%); transform: translateY(-50%) scale(1.1); }

        button { width: 100%; padding: 12px; background: #1390d3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        button:hover { background: #21da0c; }
        
        .hacker-note { background: #fff3cd; padding: 15px; border-radius: 5px; margin-top: 25px; color: #856404; border: 1px solid #ffeeba; font-size: 0.9em; }
        code { background: rgba(0,0,0,0.1); padding: 2px 5px; border-radius: 3px; font-family: monospace; font-weight: bold; }
        
        /* Console Output Style */
        #console-output { margin-top: 20px; background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 13px; white-space: pre-wrap; display: none; border: 1px solid #333; max-height: 300px; overflow-y: auto; }
        
        /* --- CSS CHO TH√îNG B√ÅO TH√ÄNH C√îNG --- */
        .success-modal {
            display: none;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2ecc71;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            font-weight: bold;
            text-align: center;
            animation: slideDown 0.5s ease-out;
            z-index: 1000;
            width: 80%;
            transition: opacity 0.5s ease;
        }
        
        @keyframes slideDown {
            from { top: -50px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="success-alert" class="success-modal">
        üéâ ƒêƒÇNG NH·∫¨P TH√ÄNH C√îNG! <br>
        <span style="font-size: 0.8em; font-weight: normal;">(Admin Access Granted)</span>
    </div>

    <div class="login-card">
        <h1>Login</h1>
        
        <div class="input-group">
            <label>Username</label>
            <input type="text" id="username" placeholder="Nh·∫≠p username">
        </div>
        
        <div class="input-group">
            <label>Password</label>
            <div class="password-wrapper">
                <input type="password" id="password" placeholder="Nh·∫≠p password">
                <span class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
            </div>
        </div>

        <button onclick="handleLogin()">ƒêƒÉng nh·∫≠p</button>

        <div class="hacker-note">
            <strong>‚ö†Ô∏è L∆∞u √Ω Lab CVE-2025-1094:</strong><br>
            S·ª≠ d·ª•ng <code>¬ø</code> ƒë·ªÉ gi·∫£ l·∫≠p byte l·ªói.<br>
            V√≠ d·ª•: <code>¬ø'; \! ls; #</code>
        </div>
        
        <div id="console-output"></div>
    </div>

    <script>
        // --- H√ÄM B·∫¨T/T·∫ÆT HI·ªÇN TH·ªä PASSWORD ---
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.querySelector('.toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.innerText = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleBtn.innerText = 'üëÅÔ∏è';
            }
        }

        async function handleLogin() {
            const userVal = document.getElementById('username').value;
            const passVal = document.getElementById('password').value;
            const output = document.getElementById('console-output');
            const successAlert = document.getElementById('success-alert');
            
            output.style.display = "block";
            output.innerText = "ƒêang x√°c th·ª±c...";
            
            successAlert.style.display = "none";
            successAlert.style.opacity = "1";

            // --- CHUY·ªÇN PASSWORD SANG HEX ---
            let passHex = "";
            for (let i = 0; i < passVal.length; i++) {
                if (passVal.substring(i, i + 5) === "[BAD]") {
                    passHex += "bf";
                    i += 4;
                } else {
                    passHex += passVal.charCodeAt(i).toString(16).padStart(2, '0');
                }
            }

            try {
                const res = await fetch('/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: userVal, passwordHex: passHex })
                });
                
                const data = await res.json();
                
                let logContent = `>> SQL SERVER NH·∫¨N ƒê∆Ø·ª¢C:\n${data.sql}\n\n`;
                logContent += `>> K·∫æT QU·∫¢ T·ª™ QUERY:\n${data.data}`;
                if (data.raw_error) logContent += `\n>> STDERR:\n${data.raw_error}`;
                
                output.innerText = logContent;

                // --- LOGIC HI·ªÇN TH·ªä TH√îNG B√ÅO ---
                if (data.data && (data.data.includes("(1 row)") || data.data.includes("admin@fcode.org"))) {
                    successAlert.style.display = "block";
                    
                    // --- T·ª∞ ƒê·ªòNG T·∫ÆT SAU 3 GI√ÇY ---
                    setTimeout(() => {
                        successAlert.style.opacity = "0";
                        
                        setTimeout(() => {
                            successAlert.style.display = "none";
                        }, 500);
                        
                    }, 3000); // ƒê·ª£i 3000ms = 3 gi√¢y
                }

            } catch (e) {
                output.innerText = "L·ªói k·∫øt n·ªëi: " + e;
            }
        }
    </script>
</body>
</html>